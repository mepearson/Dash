language: generic
addons:
  ssh_known_hosts:
  - vm1.mint.isi.edu
env:
  matrix:
  - DOCKER_COMPOSE_VERSION=1.23.2
  global:
    secure: W5bn9Ua5GDJ2N5vVaDEI0+CdOYuh67hSXx19GA+q5FJkGIseBYxpLkxqJw/GiIqlaqGs2WUZrDGRmPHCesXKMdXLZ7nQ5wSkio7Ls9ysesizY2B6gQ044PhlnvqwnPPB5kD4Hs0Cm5vVr7vyzlyk7Git3ejaQQtn0ithZ+lBQshG7JaCoO8LYNarY3VROiRV66BtkbIVXhRJJcPmAMA154WTXnG4VdRkrJ5/UGxGmIzZ/PCRPQu727yMtXmyNaVfXUD8Gb5RTRQIv2HMB5xGprxwX7WaPOqiG6CxvUk/EvFDiT7TPSsxOkmRZPXD1HGHYCgnYDFoEbJjEJuEL0d3IRRIZXxf9q437uB0oGhoEIXfnD24FYtTfh5wMdg32BKxnbPF5rLVqHvEu/qV9964IfUtJwFHOk8UPmdbh4ZUBrbMYaLYdGfWM6b3MhzxScqW9bVeWk6VEVqdIjLGTp+/BD080U72D1ZvzDSGUJ2dA2JSPxsf3T0Rg6cFTpHliRUsu4WL/IHPG4zJ6nNVg1Pg2AE8VUNx1jdFtb2f0T97oH4D19lKU/dOiz4PADXoJI7fv6li2t0226SKM9Vz4NTxkTEeYGbMOfd+rO/8VlKy7hP5YRprKtv7CeKw6a4BnbLvBqrSZnu6o9Z9M7WR0Tv6UqwPNfDIF7Ks9LYg+c03tnY=
services:
- docker
before_install:
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
- docker-compose build
- docker-compose push
before_deploy:
- echo $key_pass | gpg --passphrase-fd 0 id_travis_rsa.gpg
- eval "$(ssh-agent -s)"
- chmod 600 id_travis_rsa
- ssh-add id_travis_rsa
deploy:
- provider: script
  skip_cleanup: true
  script: bash scripts/deploy.sh /etc/docker/services/dev/viz_dash/docker-compose.yml up -d
  on:
    all_branches: true
    condition: "$TRAVIS_BRANCH =~ ^(dev)$"
